<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lucky_JAN｜全自動生成・打散・由小到大排序（Mario Style）</title>
  <style>
    :root{
      --sky1:#7dd3ff;
      --sky2:#4aa3ff;
      --panel:#ffffff;
      --ink:#0f172a;
      --sub:#475569;
      --accent:#ffcc00;       /* 問號磚黃 */
      --accent2:#ff3b30;      /* 瑪利歐紅 */
      --green:#00c853;
      --blue:#2563eb;
      --border:#dbeafe;
      --shadow:0 18px 45px rgba(2, 8, 23, .18);
      --radius:22px;
      --radius2:16px;
      --cardW:70px;
      --cardH:92px;
      --gap:10px;
    }

    *{box-sizing:border-box;}
    html,body{height:100%;}
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", "Microsoft JhengHei", sans-serif;
      color:var(--ink);
      background: radial-gradient(circle at 20% 10%, #dff4ff 0%, transparent 40%),
                  radial-gradient(circle at 80% 20%, #e8f1ff 0%, transparent 42%),
                  linear-gradient(180deg, var(--sky1), var(--sky2));
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding:22px 14px 28px;
    }

    /* 背景雲朵（純 CSS） */
    .cloud{
      position:fixed;
      top:50px;
      left:8%;
      width:180px; height:60px;
      background:rgba(255,255,255,.85);
      border-radius:999px;
      filter: drop-shadow(0 10px 15px rgba(2,8,23,.10));
      z-index:-1;
    }
    .cloud::before,.cloud::after{
      content:"";
      position:absolute;
      background:rgba(255,255,255,.85);
      border-radius:999px;
    }
    .cloud::before{ width:80px; height:80px; left:18px; top:-35px; }
    .cloud::after{ width:100px; height:100px; left:75px; top:-55px; }
    .cloud.c2{ top:110px; left:auto; right:10%; transform:scale(.9); opacity:.95;}
    .cloud.c3{ top:170px; left:40%; transform:scale(.75); opacity:.85;}

    .wrap{
      width:100%;
      max-width:1100px;
      background:rgba(255,255,255,.92);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      border:1px solid rgba(255,255,255,.65);
      overflow:hidden; /* ✅避免你之前那種奇怪露出塊 */
      position:relative;
    }

    header{
      padding:18px 18px 14px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.88), rgba(255,255,255,.65));
      border-bottom:1px solid rgba(15,23,42,.08);
      display:flex;
      gap:14px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .brand{
      display:flex;
      gap:12px;
      align-items:center;
      min-width:260px;
    }
    .badge{
      width:52px;height:52px;
      border-radius:14px;
      background:linear-gradient(135deg, var(--accent2), #ff7a66);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#fff;
      font-weight:800;
      letter-spacing:.5px;
      box-shadow:0 14px 26px rgba(255,59,48,.35);
      flex:0 0 auto;
    }
    .title h1{
      margin:0;
      font-size:18px;
      line-height:1.2;
    }
    .title p{
      margin:4px 0 0;
      font-size:13px;
      color:var(--sub);
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .field{
      background:rgba(2,8,23,.04);
      border:1px solid rgba(2,8,23,.08);
      border-radius:999px;
      padding:8px 10px;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .field label{
      font-size:12px;
      color:var(--sub);
      white-space:nowrap;
    }
    input[type="number"]{
      width:92px;
      padding:6px 8px;
      border-radius:12px;
      border:1px solid rgba(2,8,23,.12);
      outline:none;
      background:#fff;
      font-size:13px;
    }
    input[type="range"]{
      width:140px;
      accent-color: var(--blue);
    }
    .btn{
      border:none;
      cursor:pointer;
      border-radius:14px;
      padding:10px 14px;
      font-weight:700;
      font-size:13px;
      color:#0b1220;
      box-shadow:0 12px 22px rgba(2,8,23,.12);
      transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow:0 16px 28px rgba(2,8,23,.16); filter:brightness(1.02); }
    .btn:active{ transform: translateY(0px); box-shadow:0 10px 18px rgba(2,8,23,.12); }

    /* 瑪利歐問號磚風格按鈕 */
    .btn.primary{
      background: linear-gradient(180deg, #ffe08a, var(--accent));
      border:2px solid #a16207;
      position:relative;
      padding-left:44px;
    }
    .btn.primary::before{
      content:"?";
      position:absolute;
      left:12px; top:50%;
      transform:translateY(-50%);
      width:22px; height:22px;
      border-radius:6px;
      display:flex;
      align-items:center;
      justify-content:center;
      background: rgba(255,255,255,.55);
      border:1px solid rgba(161,98,7,.45);
      font-weight:900;
    }

    .btn.secondary{
      background: linear-gradient(180deg, #e9f2ff, #d7e7ff);
      border:1px solid rgba(37,99,235,.25);
      color:#0f172a;
    }

    main{
      padding:16px 18px 18px;
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
    }

    .panel{
      background:var(--panel);
      border-radius:var(--radius2);
      border:1px solid rgba(2,8,23,.08);
      box-shadow: 0 12px 24px rgba(2,8,23,.08);
      overflow:hidden;
    }

    .panel-hd{
      padding:10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background:linear-gradient(180deg, rgba(37,99,235,.08), rgba(37,99,235,0));
      border-bottom:1px solid rgba(2,8,23,.06);
    }
    .panel-hd .left{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .step{
      font-weight:900;
      font-size:13px;
      padding:5px 10px;
      border-radius:999px;
      background:rgba(37,99,235,.10);
      color:#1d4ed8;
      border:1px solid rgba(37,99,235,.18);
    }
    .hd-title{
      font-weight:800;
      font-size:14px;
    }
    .meta{
      font-size:12px;
      color:var(--sub);
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .pill{
      padding:5px 10px;
      border-radius:999px;
      background:rgba(2,8,23,.04);
      border:1px solid rgba(2,8,23,.08);
      white-space:nowrap;
    }

    .panel-bd{
      padding:12px;
    }

    .cards{
      display:flex;
      flex-wrap:wrap;
      gap:var(--gap);
      align-items:flex-start;
      min-height: calc(var(--cardH) + 6px);
      background: linear-gradient(180deg, rgba(219,234,254,.55), rgba(219,234,254,.18));
      border:1px dashed rgba(37,99,235,.30);
      border-radius:14px;
      padding:12px;
    }

    /* 撲克牌卡片 */
    .card{
      width:var(--cardW);
      height:var(--cardH);
      border-radius:14px;
      background: #fff;
      border:2px solid rgba(15,23,42,.85);
      box-shadow: 0 10px 18px rgba(2,8,23,.12);
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      font-weight:900;
      font-size:26px;
      line-height:1;
      transform: translateZ(0);
    }

    /* 角標（像牌的角） */
    .card .corner{
      position:absolute;
      top:8px; left:8px;
      font-size:12px;
      font-weight:900;
      color:#0f172a;
      opacity:.9;
    }
    .card .corner.br{
      top:auto; left:auto;
      bottom:8px; right:8px;
      transform: rotate(180deg);
    }

    /* 瑪利歐裝飾：小蘑菇點點（不會跑版） */
    .card::before{
      content:"";
      position:absolute;
      inset:10px;
      border-radius:10px;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,59,48,.18) 0 8px, transparent 9px),
        radial-gradient(circle at 65% 55%, rgba(37,99,235,.16) 0 7px, transparent 8px),
        radial-gradient(circle at 40% 75%, rgba(0,200,83,.14) 0 7px, transparent 8px);
      pointer-events:none;
      opacity:.9;
    }

    /* 比較/交換高亮 */
    .card.compare{
      outline:4px solid rgba(255,204,0,.85);
      outline-offset:2px;
      transform: translateY(-2px);
    }
    .card.swap{
      outline:4px solid rgba(255,59,48,.85);
      outline-offset:2px;
      transform: translateY(-2px);
    }

    .progress{
      width:200px;
      height:10px;
      background:rgba(2,8,23,.08);
      border-radius:999px;
      overflow:hidden;
      border:1px solid rgba(2,8,23,.10);
    }
    .bar{
      width:0%;
      height:100%;
      background:linear-gradient(90deg, var(--green), #7cfa9a);
      border-radius:999px;
      transition: width .12s ease;
    }

    .note{
      font-size:12px;
      color:var(--sub);
      margin-top:8px;
      line-height:1.5;
    }

    footer{
      padding:10px 14px;
      border-top:1px solid rgba(2,8,23,.08);
      background:rgba(255,255,255,.75);
      font-size:12px;
      color:rgba(71,85,105,.95);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    footer a{
      color:#1d4ed8;
      text-decoration:none;
    }
    footer a:hover{ text-decoration:underline; }

    @media (max-width: 520px){
      :root{ --cardW:64px; --cardH:86px; --gap:8px; }
      .title h1{ font-size:16px; }
      .controls{ justify-content:flex-start; }
      .progress{ width:160px; }
    }
  </style>
</head>
<body>
  <div class="cloud"></div>
  <div class="cloud c2"></div>
  <div class="cloud c3"></div>

  <div class="wrap">
    <header>
      <div class="brand">
        <div class="badge">LJ</div>
        <div class="title">
          <h1>全自動：生成 → 打散 → 由小到大排序</h1>
          <p>Mario 風格・撲克牌顯示・泡沫排序動畫（不用你手動點）</p>
        </div>
      </div>

      <div class="controls">
        <div class="field">
          <label for="n">數量 N</label>
          <input id="n" type="number" min="2" max="60" value="20" />
        </div>
        <div class="field">
          <label for="speed">速度</label>
          <input id="speed" type="range" min="1" max="30" value="14" />
          <span id="speedLabel" style="font-size:12px;color:var(--sub);min-width:54px;text-align:right;">14</span>
        </div>
        <button class="btn primary" id="runBtn">一鍵全自動</button>
        <button class="btn secondary" id="resetBtn">重置</button>
      </div>
    </header>

    <main>
      <!-- ① 生成 -->
      <section class="panel">
        <div class="panel-hd">
          <div class="left">
            <span class="step">①</span>
            <span class="hd-title">生成（1 ～ N）</span>
          </div>
          <div class="meta">
            <span class="pill" id="genMeta">尚未生成</span>
          </div>
        </div>
        <div class="panel-bd">
          <div class="cards" id="genArea"></div>
          <div class="note">這區會顯示依序排列的牌面（1, 2, 3...）。</div>
        </div>
      </section>

      <!-- ② 打散 -->
      <section class="panel">
        <div class="panel-hd">
          <div class="left">
            <span class="step">②</span>
            <span class="hd-title">打散（Fisher–Yates 洗牌）</span>
          </div>
          <div class="meta">
            <span class="pill" id="shufMeta">尚未打散</span>
          </div>
        </div>
        <div class="panel-bd">
          <div class="cards" id="shufArea"></div>
          <div class="note">這區會顯示隨機打散結果（每次都不一樣）。</div>
        </div>
      </section>

      <!-- ③ 自動排序 -->
      <section class="panel">
        <div class="panel-hd">
          <div class="left">
            <span class="step">③</span>
            <span class="hd-title">自動排序（由小到大，泡沫排序動畫）</span>
          </div>
          <div class="meta">
            <span class="pill" id="sortMeta">等待開始</span>
            <div class="progress" aria-label="progress">
              <div class="bar" id="bar"></div>
            </div>
            <span class="pill" id="pct">0%</span>
          </div>
        </div>
        <div class="panel-bd">
          <div class="cards" id="sortArea"></div>
          <div class="note">這區會自動跑排序動畫：會高亮「正在比較」與「正在交換」的牌。</div>
        </div>
      </section>

      <!-- 完成結果 -->
      <section class="panel">
        <div class="panel-hd">
          <div class="left">
            <span class="step">✅</span>
            <span class="hd-title">排序完成（結果）</span>
          </div>
          <div class="meta">
            <span class="pill" id="doneMeta">尚未完成</span>
          </div>
        </div>
        <div class="panel-bd">
          <div class="cards" id="doneArea"></div>
          <div class="note">排序完成後，這裡會顯示最後的由小到大結果。</div>
        </div>
      </section>
    </main>

    <footer>
      <span>© Lucky_JAN · Auto Shuffle & Sort（Mario Style）</span>
      <span>回主頁：<a href="index.html">index.html</a></span>
    </footer>
  </div>

  <script>
    // ==========
    // 工具：DOM
    // ==========
    const $ = (id) => document.getElementById(id);

    const nInput = $("n");
    const speedInput = $("speed");
    const speedLabel = $("speedLabel");
    const runBtn = $("runBtn");
    const resetBtn = $("resetBtn");

    const genArea = $("genArea");
    const shufArea = $("shufArea");
    const sortArea = $("sortArea");
    const doneArea = $("doneArea");

    const genMeta = $("genMeta");
    const shufMeta = $("shufMeta");
    const sortMeta = $("sortMeta");
    const doneMeta = $("doneMeta");
    const bar = $("bar");
    const pct = $("pct");

    // ==========
    // 狀態
    // ==========
    let arr = [];
    let working = false;
    let timer = null;

    // ==========
    // 渲染（撲克牌）
    // ==========
    function renderCards(container, list, highlightA = -1, highlightB = -1, mode = "compare") {
      container.innerHTML = "";
      const frag = document.createDocumentFragment();

      for (let i = 0; i < list.length; i++) {
        const card = document.createElement("div");
        card.className = "card";
        if (i === highlightA || i === highlightB) card.classList.add(mode);

        const c1 = document.createElement("div");
        c1.className = "corner";
        c1.textContent = list[i];

        const c2 = document.createElement("div");
        c2.className = "corner br";
        c2.textContent = list[i];

        const center = document.createElement("div");
        center.style.position = "relative";
        center.style.zIndex = "1";
        center.textContent = list[i];

        card.appendChild(c1);
        card.appendChild(center);
        card.appendChild(c2);

        frag.appendChild(card);
      }
      container.appendChild(frag);
    }

    // ==========
    // ① 生成
    // ==========
    function generate(N) {
      const out = [];
      for (let i = 1; i <= N; i++) out.push(i);
      return out;
    }

    // ==========
    // ② 打散（Fisher–Yates）
    // ==========
    function shuffle(list) {
      const a = list.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const r = Math.floor(Math.random() * (i + 1));
        [a[i], a[r]] = [a[r], a[i]];
      }
      return a;
    }

    // ==========
    // ③ 自動排序（泡沫排序 step-by-step 動畫）
    // ==========
    function bubbleSortAnimate(list, speedMs) {
      // 這個函式會用 setInterval 一步一步跑，並更新畫面
      const a = list.slice();
      const n = a.length;

      let i = 0;
      let j = 0;

      // 總比較次數（用來做進度）
      const total = (n * (n - 1)) / 2;
      let doneComparisons = 0;

      // 初始顯示
      renderCards(sortArea, a);
      sortMeta.textContent = "排序中…";
      doneMeta.textContent = "尚未完成";
      bar.style.width = "0%";
      pct.textContent = "0%";

      timer = setInterval(() => {
        // 結束條件
        if (i >= n - 1) {
          clearInterval(timer);
          timer = null;

          // 完成
          renderCards(sortArea, a);
          renderCards(doneArea, a);
          sortMeta.textContent = "排序完成 ✅";
          doneMeta.textContent = `完成：共 ${total} 次比較`;
          bar.style.width = "100%";
          pct.textContent = "100%";
          working = false;
          runBtn.disabled = false;
          resetBtn.disabled = false;
          return;
        }

        // 目前要比較的位置是 j 和 j+1
        const aIdx = j;
        const bIdx = j + 1;

        // 先用 compare 高亮
        renderCards(sortArea, a, aIdx, bIdx, "compare");

        // 比較 + 必要時交換
        if (a[aIdx] > a[bIdx]) {
          // 交換時改成 swap 高亮（更明顯）
          [a[aIdx], a[bIdx]] = [a[bIdx], a[aIdx]];
          renderCards(sortArea, a, aIdx, bIdx, "swap");
        }

        // 進度
        doneComparisons++;
        const percent = Math.min(100, Math.round((doneComparisons / total) * 100));
        bar.style.width = percent + "%";
        pct.textContent = percent + "%";

        // 移動指標
        j++;
        if (j >= n - 1 - i) {
          j = 0;
          i++;
        }
      }, speedMs);
    }

    // ==========
    // 全自動流程
    // ==========
    async function runAll() {
      if (working) return;
      working = true;
      runBtn.disabled = true;
      resetBtn.disabled = true;

      // 清空顯示
      genArea.innerHTML = "";
      shufArea.innerHTML = "";
      sortArea.innerHTML = "";
      doneArea.innerHTML = "";

      genMeta.textContent = "生成中…";
      shufMeta.textContent = "等待生成";
      sortMeta.textContent = "等待開始";
      doneMeta.textContent = "尚未完成";
      bar.style.width = "0%";
      pct.textContent = "0%";

      const N = Math.max(2, Math.min(60, parseInt(nInput.value || "20", 10)));
      nInput.value = N;

      // ① 生成
      arr = generate(N);
      renderCards(genArea, arr);
      genMeta.textContent = `完成：1～${N}`;

      await sleep(450);

      // ② 打散
      shufMeta.textContent = "打散中…";
      const shuffled = shuffle(arr);
      renderCards(shufArea, shuffled);
      shufMeta.textContent = "完成：已打散";

      await sleep(400);

      // ③ 自動排序（動畫）
      const speed = getSpeedMs();
      bubbleSortAnimate(shuffled, speed);
    }

    function getSpeedMs() {
      // slider 值越大，速度越快（ms 越小）
      const v = parseInt(speedInput.value, 10);
      speedLabel.textContent = String(v);
      // 映射：1 → 90ms，30 → 10ms
      return Math.round(90 - (v - 1) * (80 / 29));
    }

    function sleep(ms) {
      return new Promise((resolve) => setTimeout(resolve, ms));
    }

    // ==========
    // 重置
    // ==========
    function resetAll() {
      if (timer) { clearInterval(timer); timer = null; }
      working = false;
      runBtn.disabled = false;

      genArea.innerHTML = "";
      shufArea.innerHTML = "";
      sortArea.innerHTML = "";
      doneArea.innerHTML = "";

      genMeta.textContent = "尚未生成";
      shufMeta.textContent = "尚未打散";
      sortMeta.textContent = "等待開始";
      doneMeta.textContent = "尚未完成";
      bar.style.width = "0%";
      pct.textContent = "0%";
    }

    // ==========
    // 事件
    // ==========
    speedInput.addEventListener("input", () => { getSpeedMs(); });
    runBtn.addEventListener("click", runAll);
    resetBtn.addEventListener("click", () => {
      resetAll();
    });

    // 初始顯示速度值
    getSpeedMs();
  </script>
</body>
</html>
